<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop_service.mapper.ShopRechargeRecordMapper">
    <select id="selectAdminShopRechargeRecordVoPage" resultType="com.shop_service.model.response.AdminShopRechargeRecordVo">
        SELECT
            t1.shop_id,
            t1.shop_no,
            t2.name AS shopName,
            t1.amount,
            t1.fee_amount,
            t1.deposit_amount,
            t1.manner,
            t1.credential,
            t1.create_time
        FROM shop_recharge_record t1
        LEFT JOIN shop t2 ON t1.shop_id = t2.id
        <where>
            AND t1.deleted = 0
            AND t2.deleted = 0
            <if test="query != null">
                <if test="query.shopId != null">
                    AND t1.shop_id = #{query.shopId}
                </if>
                <if test="query.shopNo != null and query.shopNo != ''">
                    AND t1.shop_no LIKE CONCAT('%', #{query.shopNo}, '%')
                </if>
                <if test="query.shopName != null and query.shopName != ''">
                    AND t2.name LIKE CONCAT('%', #{query.shopName}, '%')
                </if>
                <if test="query.credential != null and query.credential != ''">
                    AND t1.credential LIKE CONCAT('%', #{query.credential}, '%')
                </if>
            </if>
        </where>
        ORDER BY t1.create_time DESC, t1.id DESC
    </select>

    <select id="selectTotalAmount" resultType="decimal">
        SELECT COALESCE(SUM(amount), 0)
        FROM shop_recharge_record
        <where>
            AND deleted = 0
            <if test="date != null">
                AND DATE(create_time) = #{date}
            </if>
        </where>
    </select>

    <select id="selectTotalFeeAmount" resultType="decimal">
        SELECT COALESCE(SUM(fee_amount), 0)
        FROM shop_recharge_record
        <where>
            AND deleted = 0
            <if test="date != null">
                AND DATE(create_time) = #{date}
            </if>
        </where>
    </select>
</mapper>