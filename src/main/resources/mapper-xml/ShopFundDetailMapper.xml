<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop_service.mapper.ShopFundDetailMapper">
    <select id="selectAdminShopFundDetailVoPage" resultType="com.shop_service.model.response.AdminShopFundDetailVo">
        SELECT
            t1.shop_id,
            t1.shop_no,
            t2.name AS shopName,
            t1.type,
            t1.amount,
            t1.balance_before,
            t1.balance_after,
            t1.biz_no,
            t1.remark,
            t1.create_time
        FROM shop_fund_detail t1
        LEFT JOIN shop t2 ON t1.shop_id = t2.id
        <where>
            AND t1.deleted = 0
            AND t2.deleted = 0
            <if test="query != null">
                <if test="query.shopId != null">
                    AND t1.shop_id = #{query.shopId}
                </if>
                <if test="query.shopNo != null and query.shopNo != ''">
                    AND t1.shop_no LIKE CONCAT('%', #{query.shopNo}, '%')
                </if>
                <if test="query.shopName != null and query.shopName != ''">
                    AND t2.name LIKE CONCAT('%', #{query.shopName}, '%')
                </if>
                <if test="query.type != null">
                    AND t1.type = #{query.type}
                </if>
                <if test="query.bizNo != null and query.bizNo != ''">
                    AND t1.biz_no LIKE CONCAT('%', #{query.bizNo}, '%')
                </if>
                <if test="query.remark != null and query.remark != ''">
                    AND t1.remark LIKE CONCAT('%', #{query.remark}, '%')
                </if>
            </if>
        </where>
        ORDER BY t1.create_time DESC, t1.id DESC
    </select>
</mapper>